<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é ç´„é«”é©— - åŒ…çµ¦åŠ› Givespower.health</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/">
            <img src="/img/logo/logo.png" alt="åŒ…çµ¦åŠ› Givespower.health" style="max-height: 40px; margin-right: 10px;">
            <!-- åŒ…çµ¦åŠ› Givespower.health -->
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                
                
                
                <li class="nav-item">
                    <a class="nav-link " href="/">é¦–é </a>
                </li>
                
                
                
                <li class="nav-item">
                    <a class="nav-link " href="/about.html">é—œæ–¼æˆ‘å€‘</a>
                </li>
                
                
                
                <li class="nav-item">
                    <a class="nav-link " href="/programmes.html">èª²ç¨‹ä»‹ç´¹</a>
                </li>
                
                
                
                <li class="nav-item">
                    <a class="nav-link " href="/testimonials.html">æˆåŠŸæ¡ˆä¾‹</a>
                </li>
                
                
                
                <li class="nav-item">
                    <a class="nav-link " href="/blog.html">å°ˆæ¥­åˆ†äº«</a>
                </li>
                
                
                
                <li class="nav-item">
                    <a class="nav-link " href="/faq.html">å¸¸è¦‹å•é¡Œ</a>
                </li>
                
                
                
                <li class="nav-item">
                    <a class="nav-link btn btn-primary active" href="/booking.html">é ç´„é«”é©—</a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

<style>
/* Navbar: DMC 782 dark topaz toggler */
.navbar-toggler {
    border-color: var(--dmc-782-dark-topaz);
}

.navbar-toggler-icon {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 0 30 30'%3e%3cpath stroke='%23AE7720' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
}

@media (max-width: 991px) {
    .navbar-collapse {
        padding-left: 20px;
        padding-right: 20px;
    }
    .navbar-nav {
        padding-left: 0 !important;
    }
    .navbar-nav .nav-item {
        padding-left: 0 !important;
        margin-left: 0 !important;
    }
    .navbar-nav .nav-link {
        padding-left: 0 !important;
        margin-left: 0 !important;
        text-align: left !important;
    }
    .navbar-nav .nav-link.btn-primary {
        margin: 10px 0 !important;
        margin-left: 0 !important;
        padding-left: 20px !important;
        padding-right: 20px !important;
        text-align: left !important;
        width: 100% !important;
    }
}
</style>


    <!-- Header -->
    <header class="page-header" style="padding: 150px 0 100px;">
        <div class="container text-center">
            <img src="/img/logo/logo.png" alt="åŒ…çµ¦åŠ› Givespower.health" class="logo" style="max-width: 200px; margin-bottom: 30px;">
            <h1 style="font-size: 48px; font-weight: bold; margin-bottom: 20px;">é ç´„é«”é©—</h1>
            <h3 class="lead" style="font-size: 24px; margin-bottom: 30px;">å¡«å¯«ä¸‹æ–¹è¡¨å–®ï¼Œ<br class="d-md-none">æˆ‘å€‘æœƒç›¡å¿«èˆ‡æ‚¨è¯çµ¡å®‰æ’å…è²»è«®è©¢ã€‚</h3>
            <a href="https://lin.ee/Umt7lpD" target="_blank" class="page-scroll btn btn-primary btn-lg" style="padding: 15px 40px; font-size: 18px;">ç«‹å³é ç´„é«”é©—</a>
        </div>
    </header>

    <!-- Booking Form Section -->
    <div class="container" style="padding: 80px 0;">
        <div class="row booking-form-row">
            <div class="col-md-8 booking-form-container">
                <h2 class="section-heading highlight" id="book">é ç´„è¡¨å–®</h2>
                <hr>
                <form id="bookingForm" method="POST" action="javascript:void(0);" onsubmit="return false;">
                    <div class="form-group">
                        <label for="name">å§“å *</label>
                        <input type="text" class="form-control" id="name" name="name" required placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" maxlength="50">
                        <small class="form-text text-muted" id="nameHelp">è«‹è¼¸å…¥ä¸­æ–‡ã€è‹±æ–‡ã€ç©ºæ ¼æˆ–å¸¸è¦‹æ¨™é»ç¬¦è™Ÿ</small>
                        <div class="invalid-feedback" id="nameError" style="display: none;">å§“åæ ¼å¼ä¸æ­£ç¢º</div>
                    </div>

                    <div class="form-group">
                        <label for="phone">é›»è©± *</label>
                        <input type="tel" class="form-control" id="phone" name="phone" required 
                               pattern="[0-9]{10}" 
                               placeholder="è«‹è¼¸å…¥10ä½æ•¸å­—é›»è©±è™Ÿç¢¼ï¼ˆä¾‹å¦‚ï¼š0912345678ï¼‰"
                               maxlength="10"
                               oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                        <small class="form-text text-muted" id="phoneHelp">è«‹è¼¸å…¥10ä½æ•¸å­—ï¼Œä¸å«ç©ºæ ¼ã€æ©«ç·šæˆ–ç‰¹æ®Šç¬¦è™Ÿ</small>
                        <div class="invalid-feedback" id="phoneError" style="display: none;">é›»è©±è™Ÿç¢¼å¿…é ˆæ˜¯10ä½æ•¸å­—</div>
                    </div>

                    <div class="form-group">
                        <label for="line_id">Line ID <span class="text-muted">(é¸å¡«)</span></label>
                        <input type="text" class="form-control" id="line_id" name="line_id" placeholder="è«‹è¼¸å…¥æ‚¨çš„ Line ID" maxlength="50">
                        <small class="form-text text-muted" id="lineIdHelp">è«‹è¼¸å…¥è‹±æ•¸å­—ã€åº•ç·šã€é€£å­—è™Ÿæˆ–é»è™Ÿ</small>
                        <div class="invalid-feedback" id="lineIdError" style="display: none;">Line ID æ ¼å¼ä¸æ­£ç¢º</div>
                    </div>

                    <div class="form-group">
                        <label>å¯è¯çµ¡æ™‚æ®µ *</label>
                        <div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="contact_time" id="morning" value="æ—©ä¸Š(8~12é»)" required>
                                <label class="form-check-label" for="morning">
                                    æ—©ä¸Š (8~12é»)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="contact_time" id="noon" value="ä¸­åˆ(13~18é»)">
                                <label class="form-check-label" for="noon">
                                    ä¸­åˆ (13~18é»)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="contact_time" id="evening" value="æ™šä¸Š(19~22é»)">
                                <label class="form-check-label" for="evening">
                                    æ™šä¸Š (19~22é»)
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="goal">é‹å‹•ç›®æ¨™ *</label>
                        <select class="form-control" id="goal" name="goal" required>
                            <option value="">è«‹é¸æ“‡æ‚¨çš„ç›®æ¨™</option>
                            <option value="æ¸›è‚¥">æ¸›è‚¥</option>
                            <option value="ç˜¦èº«">ç˜¦èº«</option>
                            <option value="å¥åº·">å¥åº·</option>
                            <option value="å›ºå®šé‹å‹•">å›ºå®šé‹å‹•</option>
                            <option value="ä¼æ¥­åˆä½œ">ä¼æ¥­åˆä½œ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-lg">æäº¤é ç´„</button>
                    </div>
                    
                </form>

                <div id="formMessage" style="display: none; margin-top: 20px;"></div>
            </div>

            <div class="col-md-4">
                <div class="well">
                    <h3 class="highlight text-center">æœ€æ–°æ´»å‹•</h3>
                    <hr>
                    <div class="list-group">
                        <a href="https://lin.ee/Umt7lpD" target="_blank" class="list-group-item">
                            <h4 class="list-group-item-heading">ğŸ‰ æ–°æœƒå“¡å„ªæƒ </h4>
                            <p class="list-group-item-text">åŠ å…¥å®˜æ–¹ Line ç²å¾—å°ˆå±¬æŠ˜æ‰£ç¢¼</p>
                        </a>
                        <a href="https://www.instagram.com/givespower.health" target="_blank" class="list-group-item">
                            <h4 class="list-group-item-heading">ğŸ“¸ æ¯æ—¥å¥èº«åˆ†äº«</h4>
                            <p class="list-group-item-text">è¿½è¹¤ IG ç²å¾—æœ€æ–°å¥èº«çŸ¥è­˜</p>
                        </a>
                        <a href="https://lin.ee/Umt7lpD" target="_blank" class="list-group-item">
                            <h4 class="list-group-item-heading">ğŸ’ªğŸ½ å…è²»é«”é©—èª²ç¨‹</h4>
                            <p class="list-group-item-text">é ç´„å…è²»é«”é©—ï¼Œé–‹å§‹æ‚¨çš„å¥èº«ä¹‹æ—…</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <h4>é—œæ–¼æˆ‘å€‘</h4>
                <p>åŒ…çµ¦åŠ› Givespower.health å°ˆæ³¨æ–¼æä¾›å°ˆæ¥­çš„å€‹äººè¨“ç·´æœå‹™ï¼Œå¹«åŠ©æ‚¨é”æˆå¥åº·èˆ‡å¥èº«ç›®æ¨™ã€‚æˆ‘å€‘çš„å°ˆæ¥­æ•™ç·´åœ˜éšŠæ“æœ‰è±å¯Œçš„ç¶“é©—ï¼Œç‚ºæ‚¨é‡èº«æ‰“é€ æœ€é©åˆçš„è¨“ç·´è¨ˆåŠƒã€‚</p>
            </div>
            <div class="col-md-4">
                <h4>å¿«é€Ÿé€£çµ</h4>
                <ul class="list-unstyled">
                    <li><a href="/">é¦–é </a></li>
                    <li><a href="/about.html">é—œæ–¼æˆ‘å€‘</a></li>
                    <li><a href="/programmes.html">èª²ç¨‹ä»‹ç´¹</a></li>
                    <li><a href="/testimonials.html">æˆåŠŸæ¡ˆä¾‹</a></li>
                    <li><a href="/blog.html">å°ˆæ¥­åˆ†äº«</a></li>
                    <li><a href="/faq.html">å¸¸è¦‹å•é¡Œ</a></li>
                    <li><a href="/booking.html">é ç´„é«”é©—</a></li>
                </ul>
            </div>
            <div class="col-md-4">
                <h4>è¯çµ¡æˆ‘å€‘</h4>
                <p>
                    <strong>Line:</strong> <a href="https://lin.ee/Umt7lpD" target="_blank" rel="noopener noreferrer">@givespower.health</a><br>
                    <strong>Instagram:</strong> <a href="https://www.instagram.com/givespower.health" target="_blank" rel="noopener noreferrer">@givespower.health</a><br>
                    <strong>Email:</strong> givespower.health@gmail.com
                </p>
                <div class="social-links">
                    <a href="https://lin.ee/Umt7lpD" target="_blank" rel="noopener noreferrer" title="LINE">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.349 0-.63-.285-.63-.63V8.108c0-.345.281-.63.63-.63h2.386c.349 0 .63.285.63.63 0 .346-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.63-.631.63-.346 0-.63-.286-.63-.63V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.63-.63.63-.345 0-.63-.286-.63-.63V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.771zm-2.466.63H4.917c-.348 0-.63-.286-.63-.63V8.108c0-.345.282-.63.63-.63.349 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.281.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.039 1.085l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                        </svg>
                    </a>
                    <a href="https://www.instagram.com/givespower.health" target="_blank" rel="noopener noreferrer" title="Instagram">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
        <hr>
        <div class="row text-center">
            <div class="col-md-12">
                <p>&copy; 2026 åŒ…çµ¦åŠ› Givespower.health. All rights reserved.</p>
            </div>
        </div>
    </div>
</footer>

<style>
/* Footer: DMC palette */
footer {
    background-color: var(--dmc-413-dark-pewter-gray);
    color: var(--white);
    padding: 40px 0 20px;
}

footer a {
    color: var(--dmc-727-very-light-topaz);
    transition: color 0.3s ease;
}

footer a:hover {
    color: var(--dmc-742-light-tangerine);
}

footer h4 {
    color: var(--dmc-727-very-light-topaz);
    margin-bottom: 20px;
    font-weight: bold;
}

footer ul {
    list-style: none;
    padding: 0;
}

footer ul li {
    margin-bottom: 10px;
}

footer .social-links {
    margin-top: 20px;
}

footer .social-links a {
    display: inline-block;
    margin: 0 10px;
    color: var(--dmc-727-very-light-topaz);
    transition: transform 0.3s ease, color 0.3s ease;
}

footer .social-links a:hover {
    transform: translateY(-3px);
    color: var(--dmc-742-light-tangerine);
}

footer hr {
    border-color: rgba(255, 255, 255, 0.1);
    margin: 30px 0;
}

footer p {
    margin-bottom: 10px;
}
</style>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
    // Check for success parameter in URL (from FormSubmit redirect)
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('success') === 'true') {
        const messageDiv = document.getElementById('formMessage');
        messageDiv.innerHTML = '<div class="alert alert-success">é ç´„è¡¨å–®å·²æˆåŠŸæäº¤ï¼æˆ‘å€‘æœƒç›¡å¿«èˆ‡æ‚¨è¯çµ¡ã€‚</div>';
        messageDiv.style.display = 'block';
        // Clean URL
        window.history.replaceState({}, document.title, window.location.pathname);
    }
    
    // Input sanitization function - removes HTML tags and dangerous characters
    function sanitizeInput(input) {
        if (!input) return '';
        // Remove HTML tags
        let sanitized = input.replace(/<[^>]*>/g, '');
        // Remove script tags and event handlers
        sanitized = sanitized.replace(/javascript:/gi, '');
        sanitized = sanitized.replace(/on\w+\s*=/gi, '');
        // Remove control characters except newlines and tabs
        sanitized = sanitized.replace(/[\x00-\x08\x0B-\x0C\x0E-\x1F\x7F]/g, '');
        return sanitized.trim();
    }
    
    // HTML entity escaping function
    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }
    
    // Validate name - only allows Chinese characters, English letters, spaces, and common punctuation
    function validateName(name) {
        if (!name || name.length === 0) return false;
        if (name.length > 50) return false;
        // Allow Chinese characters, English letters, spaces, and common punctuation
        const namePattern = /^[\u4e00-\u9fa5a-zA-Z\s\.\-\'\(\)]+$/;
        return namePattern.test(name);
    }
    
    // Validate Line ID - alphanumeric, underscores, hyphens, dots
    function validateLineId(lineId) {
        if (!lineId || lineId.length === 0) return true; // Optional field
        if (lineId.length > 50) return false;
        const lineIdPattern = /^[a-zA-Z0-9_\.\-]+$/;
        return lineIdPattern.test(lineId);
    }
    
    // Phone number validation function
    function validatePhone(phone) {
        // Remove any non-digit characters and check length
        const digitsOnly = phone.replace(/[^0-9]/g, '');
        return digitsOnly.length === 10 && /^[0-9]{10}$/.test(digitsOnly);
    }
    
    // Validate contact time - must be one of the allowed values
    function validateContactTime(contactTime) {
        const allowedValues = ['æ—©ä¸Š(8~12é»)', 'ä¸­åˆ(13~18é»)', 'æ™šä¸Š(19~22é»)'];
        return contactTime && allowedValues.includes(contactTime);
    }
    
    // Validate goal - must be one of the allowed values
    function validateGoal(goal) {
        const allowedValues = ['æ¸›è‚¥', 'ç˜¦èº«', 'å¥åº·', 'å›ºå®šé‹å‹•', 'ä¼æ¥­åˆä½œ'];
        return goal && allowedValues.includes(goal);
    }
    
    // Real-time phone validation
    const phoneInput = document.getElementById('phone');
    const phoneError = document.getElementById('phoneError');
    const phoneHelp = document.getElementById('phoneHelp');
    
    phoneInput.addEventListener('input', function() {
        const phoneValue = this.value.trim();
        
        if (phoneValue.length > 0) {
            if (validatePhone(phoneValue)) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
                phoneError.style.display = 'none';
                phoneHelp.style.color = '#28a745';
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
                phoneError.style.display = 'block';
                phoneHelp.style.color = '#dc3545';
            }
        } else {
            this.classList.remove('is-valid', 'is-invalid');
            phoneError.style.display = 'none';
            phoneHelp.style.color = '#6c757d';
        }
    });
    
    phoneInput.addEventListener('blur', function() {
        const phoneValue = this.value.trim();
        if (phoneValue.length > 0 && !validatePhone(phoneValue)) {
            this.classList.add('is-invalid');
            phoneError.style.display = 'block';
        }
    });
    
    // Real-time name validation
    const nameInput = document.getElementById('name');
    const nameError = document.getElementById('nameError');
    const nameHelp = document.getElementById('nameHelp');
    
    nameInput.addEventListener('input', function() {
        const nameValue = sanitizeInput(this.value);
        this.value = nameValue; // Update input with sanitized value
        
        if (nameValue.length > 0) {
            if (validateName(nameValue)) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
                nameError.style.display = 'none';
                nameHelp.style.color = '#28a745';
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
                nameError.style.display = 'block';
                nameHelp.style.color = '#dc3545';
            }
        } else {
            this.classList.remove('is-valid', 'is-invalid');
            nameError.style.display = 'none';
            nameHelp.style.color = '#6c757d';
        }
    });
    
    nameInput.addEventListener('blur', function() {
        const nameValue = sanitizeInput(this.value);
        this.value = nameValue;
        if (nameValue.length > 0 && !validateName(nameValue)) {
            this.classList.add('is-invalid');
            nameError.style.display = 'block';
        }
    });
    
    // Real-time Line ID validation
    const lineIdInput = document.getElementById('line_id');
    const lineIdError = document.getElementById('lineIdError');
    const lineIdHelp = document.getElementById('lineIdHelp');
    
    lineIdInput.addEventListener('input', function() {
        const lineIdValue = sanitizeInput(this.value);
        this.value = lineIdValue; // Update input with sanitized value
        
        if (lineIdValue.length > 0) {
            if (validateLineId(lineIdValue)) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
                lineIdError.style.display = 'none';
                lineIdHelp.style.color = '#28a745';
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
                lineIdError.style.display = 'block';
                lineIdHelp.style.color = '#dc3545';
            }
        } else {
            this.classList.remove('is-valid', 'is-invalid');
            lineIdError.style.display = 'none';
            lineIdHelp.style.color = '#6c757d';
        }
    });
    
    lineIdInput.addEventListener('blur', function() {
        const lineIdValue = sanitizeInput(this.value);
        this.value = lineIdValue;
        if (lineIdValue.length > 0 && !validateLineId(lineIdValue)) {
            this.classList.add('is-invalid');
            lineIdError.style.display = 'block';
        }
    });
    
    // Form submission validation and Resend API call
    document.getElementById('bookingForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        
        const messageDiv = document.getElementById('formMessage');
        const submitBtn = this.querySelector('button[type="submit"]');
        
        // Get and sanitize form values
        let name = document.getElementById('name').value.trim();
        let phone = document.getElementById('phone').value.trim();
        let lineId = document.getElementById('line_id').value.trim();
        const contactTimeRadio = document.querySelector('input[name="contact_time"]:checked');
        const goal = document.getElementById('goal').value;
        
        // Sanitize all inputs
        name = sanitizeInput(name);
        phone = sanitizeInput(phone);
        lineId = sanitizeInput(lineId);
        
        // Validate required fields
        if (!name || !phone || !contactTimeRadio || !goal) {
            messageDiv.innerHTML = '<div class="alert alert-danger">è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ã€‚</div>';
            messageDiv.style.display = 'block';
            return false;
        }
        
        const contactTime = contactTimeRadio.value;
        
        // Validate name format
        if (!validateName(name)) {
            messageDiv.innerHTML = '<div class="alert alert-danger">å§“åæ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹åªä½¿ç”¨ä¸­æ–‡ã€è‹±æ–‡ã€ç©ºæ ¼æˆ–å¸¸è¦‹æ¨™é»ç¬¦è™Ÿã€‚</div>';
            messageDiv.style.display = 'block';
            document.getElementById('name').focus();
            return false;
        }
        
        // Validate phone number format
        if (!validatePhone(phone)) {
            phoneInput.classList.add('is-invalid');
            phoneError.style.display = 'block';
            messageDiv.innerHTML = '<div class="alert alert-danger">é›»è©±è™Ÿç¢¼å¿…é ˆæ˜¯10ä½æ•¸å­—ï¼Œä¸å«ç©ºæ ¼ã€æ©«ç·šæˆ–ç‰¹æ®Šç¬¦è™Ÿã€‚</div>';
            messageDiv.style.display = 'block';
            phoneInput.focus();
            return false;
        }
        
        // Validate Line ID format (if provided)
        if (lineId && !validateLineId(lineId)) {
            messageDiv.innerHTML = '<div class="alert alert-danger">Line ID æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹åªä½¿ç”¨è‹±æ•¸å­—ã€åº•ç·šã€é€£å­—è™Ÿæˆ–é»è™Ÿã€‚</div>';
            messageDiv.style.display = 'block';
            document.getElementById('line_id').focus();
            return false;
        }
        
        // Validate contact time (whitelist check)
        if (!validateContactTime(contactTime)) {
            messageDiv.innerHTML = '<div class="alert alert-danger">è«‹é¸æ“‡æœ‰æ•ˆçš„è¯çµ¡æ™‚æ®µã€‚</div>';
            messageDiv.style.display = 'block';
            return false;
        }
        
        // Validate goal (whitelist check)
        if (!validateGoal(goal)) {
            messageDiv.innerHTML = '<div class="alert alert-danger">è«‹é¸æ“‡æœ‰æ•ˆçš„é‹å‹•ç›®æ¨™ã€‚</div>';
            messageDiv.style.display = 'block';
            return false;
        }
        
        // Show loading state
        submitBtn.disabled = true;
        submitBtn.textContent = 'æäº¤ä¸­...';
        messageDiv.style.display = 'none';
        
        // Prepare email content with sanitized and escaped values
        const safeName = escapeHtml(name);
        const safePhone = escapeHtml(phone);
        const safeLineId = lineId ? escapeHtml(lineId) : 'æœªæä¾›';
        const safeContactTime = escapeHtml(contactTime);
        const safeGoal = escapeHtml(goal);
        const timestamp = new Date().toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' });
        
        const emailContent = `
æ–°é ç´„è¡¨å–® - åŒ…çµ¦åŠ› Givespower.health

å§“å: ${safeName}
é›»è©±: ${safePhone}
Line ID: ${safeLineId}
å¯è¯çµ¡æ™‚æ®µ: ${safeContactTime}
é‹å‹•ç›®æ¨™: ${safeGoal}

æäº¤æ™‚é–“: ${timestamp}
        `.trim();
        
        try {
            // Check if running on localhost (local development)
            const isLocalhost = window.location.hostname === 'localhost' || 
                               window.location.hostname === '127.0.0.1' ||
                               window.location.hostname === '';
            
            // Use local API server on localhost, Vercel serverless function on production
            const apiUrl = isLocalhost 
                ? 'http://localhost:3001/api/send-email'
                : window.location.origin + '/api/send-email';
            
            // console.log('Sending request to:', apiUrl);
            // console.log('Request data:', { to: 'givespower.health@gmail.com', subject: 'æ–°é ç´„è¡¨å–® - åŒ…çµ¦åŠ› Givespower.health', text: emailContent });
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    to: 'givespower.health@gmail.com',
                    subject: 'æ–°é ç´„è¡¨å–® - åŒ…çµ¦åŠ› Givespower.health',
                    text: emailContent,
                })
            });
            
            // Check if response is ok before parsing JSON
            if (!response.ok) {
                let errorMessage = 'æäº¤å¤±æ•—';
                try {
                    const errorData = await response.json();
                    errorMessage = errorData.error || errorMessage;
                } catch (e) {
                    errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                }
                throw new Error(errorMessage);
            }
            
            const result = await response.json();
            
            if (result.success) {
                // Success
                messageDiv.innerHTML = '<div class="alert alert-success">é ç´„è¡¨å–®å·²æˆåŠŸæäº¤ï¼æˆ‘å€‘æœƒç›¡å¿«èˆ‡æ‚¨è¯çµ¡ã€‚</div>';
                messageDiv.style.display = 'block';
                
                // Reset form
                this.reset();
                phoneInput.classList.remove('is-valid', 'is-invalid');
                phoneError.style.display = 'none';
                
                // Scroll to message
                messageDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                throw new Error(result.error || 'æäº¤å¤±æ•—');
            }
        } catch (error) {
            console.error('Form submission error:', error);
            const errorMsg = error.message || 'æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–ç›´æ¥é€é Line è¯çµ¡æˆ‘å€‘ã€‚';
            messageDiv.innerHTML = `<div class="alert alert-danger">${errorMsg}</div>`;
            messageDiv.style.display = 'block';
        } finally {
            // Reset button state
            submitBtn.disabled = false;
            submitBtn.textContent = 'æäº¤é ç´„';
        }
    });
    </script>
</body>
</html>
